"use strict";function init(){var e=(require("os"),require("path")),t=(require("http"),require("../common/request/request.js")),r=require("fs"),n=require("../stores/windowStores.js"),i=require("../stores/projectStores.js"),a=require("../config/dirConfig.js"),o=(require("url"),nw.App,a.WeappFileCache),s="tmp",u="store",c="wxfile://",l=function(t){var i=void 0,a=n.getUserInfo(),u=a?a.openid:"unknow";do i=s+"_"+t+u+ +new Date;while(r.existsSync(e.join(o,i)));return i};_exports={isAppTmpPath:function(e){return 0===e.indexOf(c)},getRealPath:function(t){if(this.isAppTmpPath(t)){var r=t.replace(c,"");return e.join(o,r)}return t},copyFileDataToTemp:function(t,n,i){var a=l(n);return r.writeFileSync(e.join(o,""+a+i),t),""+c+a+i},copyFileToTemp:function(e,t,n){if(r.existsSync(e)){var i=r.readFileSync(e);return this.copyFileDataToTemp(i,t,n)}return!1},saveFileForever:function(e){var t=this.getRealPath(e);if(r.existsSync(t)){var n=e.replace(s,u);return r.renameSync(t,this.getRealPath(n)),n}return!1},uploadFileToServer:function(e){var n=e.url,i=e.filePath,a=e.name,o=e.header,s=e.formData,u=e.tlsVersionCheck,c={};u&&(c.secureProtocol="TLSv1_2_method"),o=o||{},s=s||{},s[a]=r.createReadStream(this.getRealPath(i)),t({url:n,agentOptions:c,method:"post",needToken:-1,headers:o,formData:s},function(t,r,n){e.callback&&e.callback(t,r,n)})},downloadFileFormServer:function(e){var r=e.url,n=e.header,i=e.tlsVersionCheck;n=n||{};var a={};i&&(a.secureProtocol="TLSv1_2_method"),t({url:r,agentOptions:a,method:"get",encoding:null,needToken:-1,headers:n},function(t,r,n){e.callback&&e.callback(t,r,n)})},getSavedFileList:function(){var t=i.getCurrentProject(),a=t.hash,s=n.getUserInfo(),l=s?s.openid:"unknow",f=r.readdirSync(o).filter(function(e){return!!~e.indexOf(u+"_"+a+l)}),h=0,p=f.reduce(function(t,n){var i=r.statSync(e.join(o,n));return h=i.size+h,t.push({filePath:""+c+n,size:i.size,createTime:parseInt(i.ctime.getTime()/1e3)}),t},[]);return{fileList:p,totalSize:h}},getFileStat:function(e){var t=this.getRealPath(e),n=void 0;return r.existsSync(t)&&(n=r.statSync(t)),n},removeSavedFile:function(e){var t=this.getRealPath(e),n=!1;return r.existsSync(t)&&(r.unlinkSync(t),n=!0),n},saveBase64DataToFile:function(t,n){var a=i.getCurrentProject(),s=a.hash,u=new Buffer(t,"base64").toString("binary"),f=l(s);return r.writeFileSync(e.join(o,""+f+n),u,"binary"),""+c+f+n}}}var _exports;init(),module.exports=_exports;