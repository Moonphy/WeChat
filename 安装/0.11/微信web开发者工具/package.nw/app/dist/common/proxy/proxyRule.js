"use strict";function init(){function e(e){var t=e.headers.host,o=e.connection.encrypted&&!/^http:/.test(e.url)?"https":"http",n="http"===o?e.url:o+"://"+t+e.url,p=r.parse(n);return p.pureHref=p.href.replace(/\?.*/,"").replace(/\#.*/,""),p}var r=(require("fs"),require("url")),t=require("path"),o=(require("zlib"),require("../../utils/report.js"),require("../../weapp/weApp.js")),n=require("../../config/config.js"),p="https://clients1.google.com/tbproxy/af/",i=n.weappURLRegular,s=n.weappASURLRegular,u=n.weappLocalIdRegular;_exports={shouldUseLocalResponse:function(r,t){var o=e(r),n=o.pureHref;return!!i.test(n)||(0===n.indexOf(p)||(!!s.test(n)||!!u.test(n)))},dealLocalResponse:function(r,n,a){var c=e(r),l=c.pureHref;i.test(l)?!function(){var e=c.href;o.getResponse(e,function(r,o,n){if(r)return void a(r,o,n||"");t.extname(e).replace(".","");a(200,o,n)})}():0===l.indexOf(p)?(console.error(p),a(400,{},"")):s.test(l)?o.getAppservice(l,function(e,r,t){return e?void a(e,{},t):void a(200,r,t)}):u.test(l)&&o.getLocalIdResponse(l.replace(u,"wxfile://"),function(e,r,t){return e?void a(e,{},t):void a(200,r,t)})}}}var _exports;init(),module.exports=_exports;