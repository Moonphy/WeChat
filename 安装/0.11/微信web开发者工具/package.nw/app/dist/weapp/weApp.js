"use strict";function _defineProperty(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function init(){var e=global.appConfig.isDev,r=require("../config/config.js"),s=r.JSON_PARSE_ERROR,t=r.ES6_ERROR,i=r.JSON_FILE_ERROR,n=r.JSON_ENTRANCE_ERROR,p=require("./trans/transManager.js"),o=require("./utils/tools.js"),c=(require("async"),require("fs")),a=require("path"),u=require("url"),l=require("./utils/vendorManager.js"),f=(require("glob"),require("./utils/projectManager.js")),j=require("../config/appserviceConfig.js"),g=require("../stores/projectStores.js"),v=require("../stores/windowStores.js"),d=require("../actions/windowActions.js"),h=require("./utils/parseErr.js"),_=require("../utils/file.js"),y=(require("./tpl/errorTpl.js"),require("./tpl/appserviceErrorTpl.js"),a.join(__dirname,"appservice/asdebug.js")),m=c.readFileSync(y,"utf8");o.noBrowser.join(",");_exports.getAppservice=function(r,p){var _=o.getProject(r),y=u.parse(r),q=y.pathname,R=/appservice$/.test(q),S=/appservice-sdk\.js$/.test(q),b=/asdebug\.js$/.test(q),w=/ascheck\.js$/.test(q),E=/webnode\.js$/.test(q),C=/reporter-sdk\.js/.test(q),x=/app_service_engine\.js/.test(q),F=(/\.js$/.test(q),/\.js\.map$/.test(q)),k=/WAService\.js/.test(q),O=/favicon\.ico$/.test(q);if(O)p(200,{},"");else if(k)p(null,{},l.getFile("WAService.js"));else if(C)p(null,{},l.getFile("reporter-sdk.js"));else if(x)p(null,{},l.getFile("app_service_engine.js"));else if(S)p(null,{},l.getFile("appservice-sdk.js"));else if(b)p(null,{},m);else if(w)p(null,{},asCheck);else if(E)p(null,{},l.getFile("webnode.js"));else if(F)!function(){var e=a.join(_.projectpath,q);c.readFile(e,function(r,s){return r?void p(404,{},"do not find "+e):void p(200,{},s)})}();else{var J=function(){var o=(_.appname.toLowerCase(),_.appid.toLowerCase(),_.hash),c=void 0;try{c=f.getAppJSONSync(_)}catch(a){return p(200,{},""),setTimeout(function(){var e=a.type,r=void 0;e===s?r=h.parseJsonParseErr(a):e===i?r=h.parseJsonFileErr(a):e===n&&(r=h.parseJsonEntranceErr(a)),d.showWeappError(a.type,r)},200),{v:void 0}}var u=g.getProjectConfig(_);c.projectConfig=u,c.appserviceConfig=j;var l=c.pages||[];if(R)!function(){var r=require("./tpl/appserviceTpl.js"),s="http://"+o+".appservice.open.weixin.qq.com/",t=[],i=[],n=[];f.getAllJSFileList(_,function(o,a){for(var u={},f=0,j=l.length;f<j;f++){var g=l[f]+".js";u[g]=!0,t.push("<script>__wxRoute = '"+l[f]+"';__wxRouteBegin = true</script>"),t.push('<script src="'+s+g+'"></script>'),t.push('<script>\n              if(__wxRouteBegin) {\n                console.group("'+new Date+' page 编译错误")\n                console.error(` '+l[f]+" 出现脚本错误或者未正确调用 Page()`)\n                console.groupEnd()\n              }\n              </script>")}for(var d=0,h=a.length;d<h;d++){var y=a[d];u[y]||("app.js"===y?n.push('<script src="'+s+y+'"></script>'):i.push('<script src="'+s+y+'"></script>'))}t=i.concat(n).concat(t),e?(t.unshift('<script src="'+s+'app_service_engine.js"></script>'),t.unshift('<script src="'+s+'reporter-sdk.js"></script>'),t.unshift('<script src="'+s+'appservice-sdk.js"></script>'),t.unshift('<script src="'+s+'webnode.js"></script>')):t.unshift('<script src="'+s+'WAService.js"></script>'),t.unshift('<script src="'+s+'asdebug.js"></script>'),c.app_nickname=_.app_nickname||_.appname,c.appname=_.appname,c.appid=_.appid,c.apphash=_.hash,c.isTourist=_.isTourist,_.isTourist&&(c.userInfo=v.getUserInfo()),c.urlCheck=_.urlCheck,t.unshift("<script>var __wxConfig = "+JSON.stringify(c)+"</script>"),r=r.replace("<script></script>",t.join("")),p(null,{},r)})}();else{var y=r.replace("http://"+o+".appservice.open.weixin.qq.com/","");f.getScripts({project:_,fileName:y,needRequire:"app.js"===y||l.indexOf(y.replace(/\.js/,""))!==-1},function(e,r){if(e)if(r){var s={file:e.sourceFileName,msg:e.e};p(null,_defineProperty({},t,encodeURIComponent(JSON.stringify(s))),r)}else e.project=_,d.showWeappError(e.type,h.parseJsFileErr(e)),p(200,{},"");else p(null,{"Content-Type":"text/javascript; charset=UTF-8"},r)})}}();if("object"===("undefined"==typeof J?"undefined":_typeof(J)))return J.v}},_exports.getLocalIdResponse=function(e,r){if(_.isAppTmpPath(e)){var s=_.getRealPath(e);c.readFile(s,function(e,s){e?r(404,{"Weapp-Error":encodeURIComponent(e)},e.toString()):r(null,{},s)})}else r(404,{},"do not find "+e)},_exports.getResponse=function(e,r){p.getResponse(e,r)}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_exports={};init(),module.exports=_exports;