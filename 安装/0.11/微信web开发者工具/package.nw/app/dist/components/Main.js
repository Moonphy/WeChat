"use strict";function init(){var e,t=require("path"),r=require("../lib/react.js"),o=require("./popup/popup.js"),s=require("./menubar/menubar.js"),i=require("./toolbar/toolbar.js"),p=require("./sidebar/sidebar.js"),a=require("./develop/develop.js"),n=require("./detail/detail.js"),c=(require("./setting/setting.js"),require("./edit/edit.js")),m=require("../weapp/utils/projectManager.js").manager,h=require("../actions/projectActions.js"),u=require("./dialog/dialog.js"),l=require("./about/about.js"),d=require("../stores/windowStores.js"),j=require("../actions/windowActions.js"),v=require("../stores/webviewStores.js"),_=require("../actions/webviewActions.js"),w=0,g=r.createClass({displayName:"Main",getInitialState:function(){var e=this.props.project?d.getLastShow():"debug",t=0,r=0;return{show:e,memory:t,cpu:r}},optProject:function(e){d.setLastShow(e),this.setState({show:e})},_projectWatcher:function(r,o,s,i){var p=this;if(this.props.project){var a=r.watcher||"edit"===this.state.show;a&&(e&&(clearTimeout(e),w++),e=setTimeout(function(){if(w>2)h.restart(p.props.project);else{var r=t.extname(s);if(".swp"===r)return;if(".json"===r||".js"===r)h.restart(p.props.project);else{var o=v.getCurrentWebviewID();_.setWebviewAction(o,{act:"reLoad"})}}w=0,e=void 0},100))}},_openProjectFile:function(){this.optProject("edit")},_memory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,r=void 0;this._memoryTime++;for(var o in e){var s=e[o];s.privateMemory&&(t+=s.privateMemory)}t=parseInt(t/1024/1024),this._memorySum+=t,r=parseInt(this._memorySum/this._memoryTime),this.setState({memory:t,memoryPre:r})},_onUpdated:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,r=0;this._cpuTime++;for(var o in e){var s=e[o];s.cpu&&(t+=s.cpu)}this._cpuSUm+=t,t=t.toFixed(2),r=(this._cpuSUm/this._cpuTime).toFixed(2),this.setState({cpu:t,cpuPre:r})},componentDidMount:function(e){m.on("FILE_CHANGE",this._projectWatcher),d.on("OPEN_PROJECT_FILE",this._openProjectFile),this._memoryTime=0,this._memorySum=0,this._cpuTime=0,this._cpuSUm=0,global.appConfig.isDev&&(chrome.processes.onUpdatedWithMemory.addListener(this._memory),chrome.processes.onUpdated.addListener(this._onUpdated))},componentWillMount:function(){m.removeListener("FILE_CHANGE",this._projectWatcher),d.removeListener("OPEN_PROJECT_FILE",this._openProjectFile),global.appConfig.isDev&&(chrome.processes.onUpdatedWithMemory.removeListener(this._memory),chrome.processes.onUpdated.removeListener(this._onUpdated))},showSetting:function(){j.showSetting()},render:function(){var e="",t="";this.props.project&&(e=r.createElement(c,{show:this.state.show,project:this.props.project}),t=r.createElement(n,{project:this.props.project,show:this.state.show}));var m="";if(global.appConfig.isDev){var h={position:"absolute",bottom:0,left:60,marginBottom:10};m=r.createElement("div",{style:h},"内存占用 ",this.state.memory,"/",this.state.memoryPre," mb, CPU ",this.state.cpu,"/",this.state.cpuPre,"%")}return r.createElement("div",{className:"main"},r.createElement(s,{lastWinStatus:this.props.lastWinStatus,appQuit:this.props.appQuit,appMin:this.props.appMin,appMax:this.props.appMax,showSetting:this.showSetting,project:this.props.project}),r.createElement(i,{project:this.props.project}),r.createElement("div",{className:"body"},r.createElement(p,{show:this.state.show,project:this.props.project,optProject:this.optProject}),r.createElement(a,{show:this.state.show,optDebugger:this.optDebugger,project:this.props.project}),e,t),r.createElement(u,null),r.createElement(o,null),r.createElement(l,null),m)}});_exports=g}var _exports;init(),module.exports=_exports;